import scrapy
import json


class TripAdvisor(scrapy.Spider):
    name = 'trip_reviews2'
    payload = "[{\"query\":\"mutation LogBBMLInteraction($interaction: ClientInteractionOpaqueInput!) {\\n  logProductInteraction(interaction: $interaction)\\n}\\n\",\"variables\":{\"interaction\":{\"productInteraction\":{\"interaction_type\":\"CLICK\",\"site\":{\"site_name\":\"ta\",\"site_business_unit\":\"Flights\",\"site_domain\":\"www.tripadvisor.com\"},\"pageview\":{\"pageview_request_uid\":\"XgDaJwokHn4AAB@IbjkAAAEH\",\"pageview_attributes\":{\"location_id\":8729060,\"geo_id\":1,\"servlet_name\":\"Airline_Review\"}},\"user\":{\"user_agent\":\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36\",\"site_persistent_user_uid\":\"web422a.105.105.168.58.16ED1C5BCB1\",\"unique_user_identifiers\":{\"session_id\":\"74588AE01C212E5515DA325C2384A739\"}},\"search\":{},\"item_group\":{\"item_group_collection_key\":\"XgDaJwokHn4AAB@IbjkAAAEH\"},\"item\":{\"product_type\":\"Flights\",\"item_id_type\":\"ta-location-id\",\"item_id\":8729060,\"item_attributes\":{\"element_type\":\"next\",\"action_name\":\"REVIEW_NAV\",\"page_number\":null,\"offset\":null,\"limit\":5}}}}}},{\"query\":\"query ReviewListQuery($locationId: Int!, $offset: Int, $limit: Int, $filters: [FilterConditionInput!], $prefs: ReviewListPrefsInput, $initialPrefs: ReviewListPrefsInput, $filterCacheKey: String, $prefsCacheKey: String, $keywordVariant: String!, $needKeywords: Boolean = true) {\\n  cachedFilters: personalCache(key: $filterCacheKey)\\n  cachedPrefs: personalCache(key: $prefsCacheKey)\\n  locations(locationIds: [$locationId]) {\\n    locationId\\n    parentGeoId\\n    name\\n    placeType\\n    reviewSummary {\\n      rating\\n      count\\n    }\\n    keywords(variant: $keywordVariant) @include(if: $needKeywords) {\\n      keywords {\\n        keyword\\n      }\\n    }\\n    ... on LocationInformation {\\n      parentGeoId\\n    }\\n    ... on LocationInformation {\\n      parentGeoId\\n    }\\n    ... on LocationInformation {\\n      name\\n      currentUserOwnerStatus {\\n        isValid\\n      }\\n    }\\n    ... on LocationInformation {\\n      locationId\\n      currentUserOwnerStatus {\\n        isValid\\n      }\\n    }\\n    ... on LocationInformation {\\n      locationId\\n      parentGeoId\\n      accommodationCategory\\n      currentUserOwnerStatus {\\n        isValid\\n      }\\n      url\\n    }\\n    reviewListPage(page: {offset: $offset, limit: $limit}, filters: $filters, prefs: $prefs, initialPrefs: $initialPrefs, filterCacheKey: $filterCacheKey, prefsCacheKey: $prefsCacheKey) {\\n      totalCount\\n      preferredReviewIds\\n      reviews {\\n        ... on Review {\\n          id\\n          url\\n          location {\\n            locationId\\n            name\\n          }\\n          createdDate\\n          publishedDate\\n          provider {\\n            isLocalProvider\\n          }\\n          userProfile {\\n            id\\n            userId: id\\n            isMe\\n            isVerified\\n            displayName\\n            username\\n            avatar {\\n              id\\n              photoSizes {\\n                url\\n                width\\n                height\\n              }\\n            }\\n            hometown {\\n              locationId\\n              fallbackString\\n              location {\\n                locationId\\n                additionalNames {\\n                  long\\n                }\\n                name\\n              }\\n            }\\n            contributionCounts {\\n              sumAllUgc\\n              helpfulVote\\n            }\\n            route {\\n              url\\n            }\\n          }\\n        }\\n        ... on Review {\\n          title\\n          language\\n          url\\n        }\\n        ... on Review {\\n          language\\n          translationType\\n        }\\n        ... on Review {\\n          roomTip\\n        }\\n        ... on Review {\\n          tripInfo {\\n            stayDate\\n          }\\n          location {\\n            placeType\\n          }\\n        }\\n        ... on Review {\\n          tripInfo {\\n            stayDate\\n          }\\n          location {\\n            placeType\\n          }\\n        }\\n        ... on Review {\\n          additionalRatings {\\n            rating\\n            ratingLabel\\n          }\\n        }\\n        ... on Review {\\n          tripInfo {\\n            tripType\\n          }\\n        }\\n        ... on Review {\\n          language\\n          translationType\\n          mgmtResponse {\\n            id\\n            language\\n            translationType\\n          }\\n        }\\n        ... on Review {\\n          text\\n          publishedDate\\n          username\\n          connectionToSubject\\n          language\\n          mgmtResponse {\\n            id\\n            text\\n            language\\n            publishedDate\\n            username\\n            connectionToSubject\\n          }\\n        }\\n        ... on Review {\\n          id\\n          locationId\\n          title\\n          text\\n          rating\\n          absoluteUrl\\n          mcid\\n          translationType\\n          mtProviderId\\n          photos {\\n            id\\n            statuses\\n            photoSizes {\\n              url\\n              width\\n              height\\n            }\\n          }\\n          userProfile {\\n            id\\n            displayName\\n            username\\n          }\\n        }\\n        ... on Review {\\n          mgmtResponse {\\n            id\\n          }\\n          provider {\\n            isLocalProvider\\n          }\\n        }\\n        ... on Review {\\n          translationType\\n          location {\\n            locationId\\n            parentGeoId\\n          }\\n          provider {\\n            isLocalProvider\\n            isToolsProvider\\n          }\\n          original {\\n            id\\n            url\\n            locationId\\n            userId\\n            language\\n            submissionDomain\\n          }\\n        }\\n        ... on Review {\\n          locationId\\n          mcid\\n          attribution\\n        }\\n        ... on Review {\\n          __typename\\n          locationId\\n          helpfulVotes\\n          photoIds\\n          route {\\n            url\\n          }\\n          socialStatistics {\\n            followCount\\n            isFollowing\\n            isLiked\\n            isReposted\\n            isSaved\\n            likeCount\\n            repostCount\\n            tripCount\\n          }\\n          status\\n          userId\\n          userProfile {\\n            id\\n            displayName\\n            isFollowing\\n          }\\n          location {\\n            __typename\\n            locationId\\n            additionalNames {\\n              normal\\n              long\\n              longOnlyParent\\n              longParentAbbreviated\\n              longOnlyParentAbbreviated\\n              longParentStateAbbreviated\\n              longOnlyParentStateAbbreviated\\n              geo\\n              abbreviated\\n              abbreviatedRaw\\n              abbreviatedStateTerritory\\n              abbreviatedStateTerritoryRaw\\n            }\\n            parent {\\n              locationId\\n              additionalNames {\\n                normal\\n                long\\n                longOnlyParent\\n                longParentAbbreviated\\n                longOnlyParentAbbreviated\\n                longParentStateAbbreviated\\n                longOnlyParentStateAbbreviated\\n                geo\\n                abbreviated\\n                abbreviatedRaw\\n                abbreviatedStateTerritory\\n                abbreviatedStateTerritoryRaw\\n              }\\n            }\\n          }\\n        }\\n        ... on Review {\\n          text\\n          language\\n        }\\n        ... on Review {\\n          locationId\\n          absoluteUrl\\n          mcid\\n          translationType\\n          mtProviderId\\n          originalLanguage\\n          rating\\n        }\\n        ... on Review {\\n          id\\n          locationId\\n          title\\n          labels\\n          rating\\n          absoluteUrl\\n          mcid\\n          translationType\\n          mtProviderId\\n          alertStatus\\n        }\\n      }\\n    }\\n    reviewAggregations {\\n      ratingCounts\\n      languageCounts\\n      alertStatusCount\\n    }\\n  }\\n}\\n\",\"variables\":{\"locationId\":8729060,\"offset\":10,\"filters\":[{\"axis\":\"LANGUAGE\",\"selections\":[\"en\"]}],\"prefs\":null,\"initialPrefs\":{},\"limit\":5,\"filterCacheKey\":null,\"prefsCacheKey\":\"locationReviewPrefs\",\"needKeywords\":false,\"keywordVariant\":\"location_keywords_v2_llr_order_30_en\"}}]"
    #i for page number and j for offset
    i =2
    j =5
    def start_requests(self):
        yield scrapy.Request(
            url='https://www.tripadvisor.com/data/graphql/batched',
            method='POST',
            headers={
                'Content-Type': 'application/json',
                'x-requested-by': 'TNI1625!ADlbNqN6OqSpornrim3R0gFKr5Vh7ZQ+g/YAuzvqiRf6rpV1cJjxclgI8KPvxIwlBnIU8UwWHjE1eqWBKjeUAUOVdnsN8hY2J4x2GivqUUW4H1G9PZe+fTgmRW2AGXacLEUwJGhXybFQnCrGhxp0qVEjjKP1BpzO5XzzHyBsWBHk',
                'cookie': 'TAUnique=%1%enc%3AjkdQerAjX5mZMz%2BATfeGxW6p9BLOQCEU1n7IkzSr46o2jHwltRJPGQ%3D%3D; TASSK=enc%3AAGcbVH42tPsvI%2FCCjtYoEkdnq3NiB7DlAi77Bmsy17u6qU1O9bEitVmP7Aknz19DdCCzEj%2F2MvGu7lc48JBjHCQVKgiZXWgXjNgdxLBiqBTCbwV1lMWtAyzGIOqXKep1Vw%3D%3D; TAPD=tripadvisor.com; ServerPool=C; TART=%1%enc%3AmTM%2FgE33hsWDhcf3Gdi8%2FqLCiVzHYd99F36NmK9%2F7PkLHaQ5rjl2lFhioSN%2BbzmfjcUVV%2FjQ5bY%3D; TATravelInfo=V2*AY.2020*AM.2*AD.13*DY.2020*DM.2*DD.15*A.2*MG.-1*HP.2*FL.3*DSM.1577411067829*AZ.1*RS.2; CM=%1%PremiumMobSess%2C%2C-1%7Ct4b-pc%2C%2C-1%7CRestAds%2FRPers%2C%2C-1%7CRCPers%2C%2C-1%7CWShadeSeen%2C%2C-1%7CTheForkMCCPers%2C%2C-1%7CHomeASess%2C7%2C-1%7CPremiumSURPers%2C%2C-1%7CPremiumMCSess%2C%2C-1%7CUVOwnersSess%2C%2C-1%7CRestPremRSess%2C%2C-1%7CCCSess%2C%2C-1%7CCYLSess%2C%2C-1%7CPremRetPers%2C%2C-1%7CViatorMCPers%2C%2C-1%7Csesssticker%2C%2C-1%7CPremiumORSess%2C%2C-1%7Ct4b-sc%2C%2C-1%7CRestAdsPers%2C%2C-1%7CMC_IB_UPSELL_IB_LOGOS2%2C%2C-1%7Cb2bmcpers%2C%2C-1%7CPremMCBtmSess%2C%2C-1%7CPremiumSURSess%2C%2C-1%7CMC_IB_UPSELL_IB_LOGOS%2C%2C-1%7CLaFourchette+Banners%2C%2C-1%7Csess_rev%2C%2C-1%7Csessamex%2C%2C-1%7CPremiumRRSess%2C%2C-1%7CTADORSess%2C%2C-1%7CAdsRetPers%2C%2C-1%7CTARSWBPers%2C%2C-1%7CSPMCSess%2C%2C-1%7CTheForkORSess%2C%2C-1%7CTheForkRRSess%2C%2C-1%7Cpers_rev%2C%2C-1%7Cmds%2C1577411068166%2C1577497468%7CSPMCWBPers%2C%2C-1%7CRBAPers%2C%2C-1%7CRestAds%2FRSess%2C%2C-1%7CHomeAPers%2C%2C-1%7CPremiumMobPers%2C%2C-1%7CRCSess%2C%2C-1%7CLaFourchette+MC+Banners%2C%2C-1%7CRestAdsCCSess%2C%2C-1%7CRestPremRPers%2C%2C-1%7CRevHubRMPers%2C%2C-1%7CUVOwnersPers%2C%2C-1%7Csh%2C%2C-1%7Cpssamex%2C%2C-1%7CTheForkMCCSess%2C%2C-1%7CCYLPers%2C%2C-1%7CCCPers%2C%2C-1%7Cb2bmcsess%2C%2C-1%7CSPMCPers%2C%2C-1%7CRevHubRMSess%2C%2C-1%7CPremRetSess%2C%2C-1%7CViatorMCSess%2C%2C-1%7CPremiumMCPers%2C%2C-1%7CAdsRetSess%2C%2C-1%7CPremiumRRPers%2C%2C-1%7CRestAdsCCPers%2C%2C-1%7CTADORPers%2C%2C-1%7CTheForkORPers%2C%2C-1%7CPremMCBtmPers%2C%2C-1%7CTheForkRRPers%2C%2C-1%7CTARSWBSess%2C%2C-1%7CPremiumORPers%2C%2C-1%7CRestAdsSess%2C%2C-1%7CRBASess%2C%2C-1%7CSPORPers%2C%2C-1%7Cperssticker%2C%2C-1%7CSPMCWBSess%2C%2C-1%7C; mp_tripadvisor_mixpanel=%7B%22distinct_id%22%3A%20%2216f304c3d2d51-0b0990f21c0049-6701b35-144000-16f304c3d2e225%22%2C%22bc_persist_updated%22%3A%201577063300401%7D; VRMCID=%1%V1*id.10568*llp.%2FAirline_Review-d8729060-Reviews-Delta-Air-Lines*e.1578084630453; TADCID=06DvhsyMMDix3fewABQC5UI2n8iqRdCoS-RMXjJFU1puNBUhup5DBaEFTSyEOmrrImi4YgEyFEhz3VJq5iqibLwBfqDtx11goRs; PMC=V2*MS.39*MD.20191221*LD.20191229; __vt=gQKF1FBMsXg_E5FEABQCKh0bQ-d8T96qptG7UVr_ZQpNxE0BMeRWBFct9Un6hXRTO2x2cF4Z8caUlTfaBQGIpsGmWToLnuoP2DdpqZjOUe73KTkG8pH4XbA_5PgMBMGp3uRpkU9_6dIb-MXnomZal6JcJQ; PAC=ADWZS76ADrdgMk4ixYJDP8urU14BUugTZfDo60e7olwTierQCzqCjBqH0cQW_JfEoyPgvHaZLAs9YNdHVkwoKIZZPVFmG14c9y9-1EyH6xN3oVMsGQWW9tLZbE4O1qXzzONVIPDASFz_Z-oNpGXRT9P1STbtfHUuo6Xy-3ne8wup8ELH9bexG775B6LyDpftk9SpJdM55zpgJFwn6NHTdtOsCp7l7glFZi2caiugEPywTfWK61q_bKc-CS5n95wgwg%3D%3D; TAReturnTo=%1%%2FAirline_Review-d8729060-Reviews-Delta-Air-Lines; roybatty=TNI1625!AE2Dz6%2BuAcdVhlrZFfqf7XKBY3pwXEdB5C7tSHI1S3JNA8nrf6ng1yT5pOAC%2FWz3c03eM2p%2B77wtc66Ns49IKox%2FrnT%2FAZgJBR3wWN2o4s7juq5l7mfzSS1gQz5hZKN2o7ELan%2BH%2FPquVYEJhVnIeNqF4p85DbwaKP4cD%2FaoFRrr%2C1; SRT=%1%enc%3AmTM%2FgE33hsWDhcf3Gdi8%2FqLCiVzHYd99F36NmK9%2F7PkLHaQ5rjl2lFhioSN%2BbzmfjcUVV%2FjQ5bY%3D; TASession=V2ID.2845C2D3AB227D209B705F6094DD0F11*SQ.60*LS.DemandLoadAjax*GR.49*TCPAR.99*TBR.83*EXEX.75*ABTR.77*PHTB.43*FS.60*CPU.63*HS.recommended*ES.popularity*DS.5*SAS.popularity*FPS.oldFirst*FA.1*DF.0*TRA.true*LD.8729060; TAUD=LA-1576960936106-1*RDD-1-2019_12_21*HC-102503825*HDD-450122831-2020_01_05.2020_01_06*ARDD-450126042-2020_02_13.2020_02_14*HD-450132067-2020_02_13.2020_02_15.150813*G-450132068-2.2.150813.*LG-669928996-2.2.T.*LD-669928997-.....',
            },
            body=self.payload,
            callback=self.parse,
        )

    def parse(self, response):
        json_response = json.loads(response.body)
        reviews = json_response[1].get('data').get('locations')[0].get('reviewListPage').get('reviews')
        for review in reviews:
            yield {
                'review_text': review.get('text'),
                'username': review.get('username'),
                'title': review.get('title'),
                'route': review.get('labels')[0],
                'class': review.get('labels')[2],
                'ratings':review.get('rating'),
                'TravelDate': review.get('tripInfo').get('stayDate'),

                # 'legroom':review.get('additionalRatings')[0].get('rating'),
                # 'Seat Comfort':review.get('additionalRatings')[1].get('rating'),
                # 'In flight Ent':review.get('additionalRatings')[2].get('rating'),
                # 'Customer Service':review.get('additionalRatings')[3].get('rating'),
                # 'Value for Money':review.get('additionalRatings')[4].get('rating'),
                # 'Cleanlines':review.get('additionalRatings')[5].get('rating'),
                # 'Check in boarding':review.get('additionalRatings')[6].get('rating'),
                # 'Food & Bevarage':review.get('additionalRatings')[7].get('rating'),
                

            }
        new_payload = "[{\"query\":\"mutation LogBBMLInteraction($interaction: ClientInteractionOpaqueInput!) {\\n  logProductInteraction(interaction: $interaction)\\n}\\n\",\"variables\":{\"interaction\":{\"productInteraction\":{\"interaction_type\":\"CLICK\",\"site\":{\"site_name\":\"ta\",\"site_business_unit\":\"Flights\",\"site_domain\":\"www.tripadvisor.com\"},\"pageview\":{\"pageview_request_uid\":\"XgDaJwokHn4AAB@IbjkAAAEH\",\"pageview_attributes\":{\"location_id\":8729060,\"geo_id\":1,\"servlet_name\":\"Airline_Review\"}},\"user\":{\"user_agent\":\"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36\",\"site_persistent_user_uid\":\"web422a.105.105.168.58.16ED1C5BCB1\",\"unique_user_identifiers\":{\"session_id\":\"74588AE01C212E5515DA325C2384A739\"}},\"search\":{},\"item_group\":{\"item_group_collection_key\":\"XgDaJwokHn4AAB@IbjkAAAEH\"},\"item\":{\"product_type\":\"Flights\",\"item_id_type\":\"ta-location-id\",\"item_id\":8729060,\"item_attributes\":{\"element_type\":\"next\",\"action_name\":\"REVIEW_NAV\",\"page_number\":2,\"offset\":5,\"limit\":5}}}}}},{\"query\":\"query ReviewListQuery($locationId: Int!, $offset: Int, $limit: Int, $filters: [FilterConditionInput!], $prefs: ReviewListPrefsInput, $initialPrefs: ReviewListPrefsInput, $filterCacheKey: String, $prefsCacheKey: String, $keywordVariant: String!, $needKeywords: Boolean = true) {\\n  cachedFilters: personalCache(key: $filterCacheKey)\\n  cachedPrefs: personalCache(key: $prefsCacheKey)\\n  locations(locationIds: [$locationId]) {\\n    locationId\\n    parentGeoId\\n    name\\n    placeType\\n    reviewSummary {\\n      rating\\n      count\\n    }\\n    keywords(variant: $keywordVariant) @include(if: $needKeywords) {\\n      keywords {\\n        keyword\\n      }\\n    }\\n    ... on LocationInformation {\\n      parentGeoId\\n    }\\n    ... on LocationInformation {\\n      parentGeoId\\n    }\\n    ... on LocationInformation {\\n      name\\n      currentUserOwnerStatus {\\n        isValid\\n      }\\n    }\\n    ... on LocationInformation {\\n      locationId\\n      currentUserOwnerStatus {\\n        isValid\\n      }\\n    }\\n    ... on LocationInformation {\\n      locationId\\n      parentGeoId\\n      accommodationCategory\\n      currentUserOwnerStatus {\\n        isValid\\n      }\\n      url\\n    }\\n    reviewListPage(page: {offset: $offset, limit: $limit}, filters: $filters, prefs: $prefs, initialPrefs: $initialPrefs, filterCacheKey: $filterCacheKey, prefsCacheKey: $prefsCacheKey) {\\n      totalCount\\n      preferredReviewIds\\n      reviews {\\n        ... on Review {\\n          id\\n          url\\n          location {\\n            locationId\\n            name\\n          }\\n          createdDate\\n          publishedDate\\n          provider {\\n            isLocalProvider\\n          }\\n          userProfile {\\n            id\\n            userId: id\\n            isMe\\n            isVerified\\n            displayName\\n            username\\n            avatar {\\n              id\\n              photoSizes {\\n                url\\n                width\\n                height\\n              }\\n            }\\n            hometown {\\n              locationId\\n              fallbackString\\n              location {\\n                locationId\\n                additionalNames {\\n                  long\\n                }\\n                name\\n              }\\n            }\\n            contributionCounts {\\n              sumAllUgc\\n              helpfulVote\\n            }\\n            route {\\n              url\\n            }\\n          }\\n        }\\n        ... on Review {\\n          title\\n          language\\n          url\\n        }\\n        ... on Review {\\n          language\\n          translationType\\n        }\\n        ... on Review {\\n          roomTip\\n        }\\n        ... on Review {\\n          tripInfo {\\n            stayDate\\n          }\\n          location {\\n            placeType\\n          }\\n        }\\n        ... on Review {\\n          tripInfo {\\n            stayDate\\n          }\\n          location {\\n            placeType\\n          }\\n        }\\n        ... on Review {\\n          additionalRatings {\\n            rating\\n            ratingLabel\\n          }\\n        }\\n        ... on Review {\\n          tripInfo {\\n            tripType\\n          }\\n        }\\n        ... on Review {\\n          language\\n          translationType\\n          mgmtResponse {\\n            id\\n            language\\n            translationType\\n          }\\n        }\\n        ... on Review {\\n          text\\n          publishedDate\\n          username\\n          connectionToSubject\\n          language\\n          mgmtResponse {\\n            id\\n            text\\n            language\\n            publishedDate\\n            username\\n            connectionToSubject\\n          }\\n        }\\n        ... on Review {\\n          id\\n          locationId\\n          title\\n          text\\n          rating\\n          absoluteUrl\\n          mcid\\n          translationType\\n          mtProviderId\\n          photos {\\n            id\\n            statuses\\n            photoSizes {\\n              url\\n              width\\n              height\\n            }\\n          }\\n          userProfile {\\n            id\\n            displayName\\n            username\\n          }\\n        }\\n        ... on Review {\\n          mgmtResponse {\\n            id\\n          }\\n          provider {\\n            isLocalProvider\\n          }\\n        }\\n        ... on Review {\\n          translationType\\n          location {\\n            locationId\\n            parentGeoId\\n          }\\n          provider {\\n            isLocalProvider\\n            isToolsProvider\\n          }\\n          original {\\n            id\\n            url\\n            locationId\\n            userId\\n            language\\n            submissionDomain\\n          }\\n        }\\n        ... on Review {\\n          locationId\\n          mcid\\n          attribution\\n        }\\n        ... on Review {\\n          __typename\\n          locationId\\n          helpfulVotes\\n          photoIds\\n          route {\\n            url\\n          }\\n          socialStatistics {\\n            followCount\\n            isFollowing\\n            isLiked\\n            isReposted\\n            isSaved\\n            likeCount\\n            repostCount\\n            tripCount\\n          }\\n          status\\n          userId\\n          userProfile {\\n            id\\n            displayName\\n            isFollowing\\n          }\\n          location {\\n            __typename\\n            locationId\\n            additionalNames {\\n              normal\\n              long\\n              longOnlyParent\\n              longParentAbbreviated\\n              longOnlyParentAbbreviated\\n              longParentStateAbbreviated\\n              longOnlyParentStateAbbreviated\\n              geo\\n              abbreviated\\n              abbreviatedRaw\\n              abbreviatedStateTerritory\\n              abbreviatedStateTerritoryRaw\\n            }\\n            parent {\\n              locationId\\n              additionalNames {\\n                normal\\n                long\\n                longOnlyParent\\n                longParentAbbreviated\\n                longOnlyParentAbbreviated\\n                longParentStateAbbreviated\\n                longOnlyParentStateAbbreviated\\n                geo\\n                abbreviated\\n                abbreviatedRaw\\n                abbreviatedStateTerritory\\n                abbreviatedStateTerritoryRaw\\n              }\\n            }\\n          }\\n        }\\n        ... on Review {\\n          text\\n          language\\n        }\\n        ... on Review {\\n          locationId\\n          absoluteUrl\\n          mcid\\n          translationType\\n          mtProviderId\\n          originalLanguage\\n          rating\\n        }\\n        ... on Review {\\n          id\\n          locationId\\n          title\\n          labels\\n          rating\\n          absoluteUrl\\n          mcid\\n          translationType\\n          mtProviderId\\n          alertStatus\\n        }\\n      }\\n    }\\n    reviewAggregations {\\n      ratingCounts\\n      languageCounts\\n      alertStatusCount\\n    }\\n  }\\n}\\n\",\"variables\":{\"locationId\":8729060,\"offset\":10,\"filters\":[{\"axis\":\"LANGUAGE\",\"selections\":[\"en\"]}],\"prefs\":null,\"initialPrefs\":{},\"limit\":5,\"filterCacheKey\":null,\"prefsCacheKey\":\"locationReviewPrefs\",\"needKeywords\":false,\"keywordVariant\":\"location_keywords_v2_llr_order_30_en\"}}]"
    
        if self.i <=4:
            new_payload = json.loads(new_payload)
            new_payload[0]['variables']['interaction']['productInteraction']['item']['item_attributes']['page_number']=self.i
            new_payload[0]['variables']['interaction']['productInteraction']['item']['item_attributes']['offset']=self.j
            self.i += 1
            self.j += 5
            yield scrapy.Request(url='https://www.tripadvisor.com/data/graphql/batched',
                                method='POST',
                                headers={
                                'Content-Type': 'application/json',
                                'x-requested-by': 'TNI1625!ADlbNqN6OqSpornrim3R0gFKr5Vh7ZQ+g/YAuzvqiRf6rpV1cJjxclgI8KPvxIwlBnIU8UwWHjE1eqWBKjeUAUOVdnsN8hY2J4x2GivqUUW4H1G9PZe+fTgmRW2AGXacLEUwJGhXybFQnCrGhxp0qVEjjKP1BpzO5XzzHyBsWBHk',
                                'cookie':'TAUnique=%1%enc%3AjkdQerAjX5mZMz%2BATfeGxW6p9BLOQCEU1n7IkzSr46o2jHwltRJPGQ%3D%3D; TASSK=enc%3AAGcbVH42tPsvI%2FCCjtYoEkdnq3NiB7DlAi77Bmsy17u6qU1O9bEitVmP7Aknz19DdCCzEj%2F2MvGu7lc48JBjHCQVKgiZXWgXjNgdxLBiqBTCbwV1lMWtAyzGIOqXKep1Vw%3D%3D; TAPD=tripadvisor.com; ServerPool=C; TART=%1%enc%3AmTM%2FgE33hsWDhcf3Gdi8%2FqLCiVzHYd99F36NmK9%2F7PkLHaQ5rjl2lFhioSN%2BbzmfjcUVV%2FjQ5bY%3D; TATravelInfo=V2*AY.2020*AM.2*AD.13*DY.2020*DM.2*DD.15*A.2*MG.-1*HP.2*FL.3*DSM.1577411067829*AZ.1*RS.2; CM=%1%PremiumMobSess%2C%2C-1%7Ct4b-pc%2C%2C-1%7CRestAds%2FRPers%2C%2C-1%7CRCPers%2C%2C-1%7CWShadeSeen%2C%2C-1%7CTheForkMCCPers%2C%2C-1%7CHomeASess%2C7%2C-1%7CPremiumSURPers%2C%2C-1%7CPremiumMCSess%2C%2C-1%7CUVOwnersSess%2C%2C-1%7CRestPremRSess%2C%2C-1%7CCCSess%2C%2C-1%7CCYLSess%2C%2C-1%7CPremRetPers%2C%2C-1%7CViatorMCPers%2C%2C-1%7Csesssticker%2C%2C-1%7CPremiumORSess%2C%2C-1%7Ct4b-sc%2C%2C-1%7CRestAdsPers%2C%2C-1%7CMC_IB_UPSELL_IB_LOGOS2%2C%2C-1%7Cb2bmcpers%2C%2C-1%7CPremMCBtmSess%2C%2C-1%7CPremiumSURSess%2C%2C-1%7CMC_IB_UPSELL_IB_LOGOS%2C%2C-1%7CLaFourchette+Banners%2C%2C-1%7Csess_rev%2C%2C-1%7Csessamex%2C%2C-1%7CPremiumRRSess%2C%2C-1%7CTADORSess%2C%2C-1%7CAdsRetPers%2C%2C-1%7CTARSWBPers%2C%2C-1%7CSPMCSess%2C%2C-1%7CTheForkORSess%2C%2C-1%7CTheForkRRSess%2C%2C-1%7Cpers_rev%2C%2C-1%7Cmds%2C1577411068166%2C1577497468%7CSPMCWBPers%2C%2C-1%7CRBAPers%2C%2C-1%7CRestAds%2FRSess%2C%2C-1%7CHomeAPers%2C%2C-1%7CPremiumMobPers%2C%2C-1%7CRCSess%2C%2C-1%7CLaFourchette+MC+Banners%2C%2C-1%7CRestAdsCCSess%2C%2C-1%7CRestPremRPers%2C%2C-1%7CRevHubRMPers%2C%2C-1%7CUVOwnersPers%2C%2C-1%7Csh%2C%2C-1%7Cpssamex%2C%2C-1%7CTheForkMCCSess%2C%2C-1%7CCYLPers%2C%2C-1%7CCCPers%2C%2C-1%7Cb2bmcsess%2C%2C-1%7CSPMCPers%2C%2C-1%7CRevHubRMSess%2C%2C-1%7CPremRetSess%2C%2C-1%7CViatorMCSess%2C%2C-1%7CPremiumMCPers%2C%2C-1%7CAdsRetSess%2C%2C-1%7CPremiumRRPers%2C%2C-1%7CRestAdsCCPers%2C%2C-1%7CTADORPers%2C%2C-1%7CTheForkORPers%2C%2C-1%7CPremMCBtmPers%2C%2C-1%7CTheForkRRPers%2C%2C-1%7CTARSWBSess%2C%2C-1%7CPremiumORPers%2C%2C-1%7CRestAdsSess%2C%2C-1%7CRBASess%2C%2C-1%7CSPORPers%2C%2C-1%7Cperssticker%2C%2C-1%7CSPMCWBSess%2C%2C-1%7C; mp_tripadvisor_mixpanel=%7B%22distinct_id%22%3A%20%2216f304c3d2d51-0b0990f21c0049-6701b35-144000-16f304c3d2e225%22%2C%22bc_persist_updated%22%3A%201577063300401%7D; VRMCID=%1%V1*id.10568*llp.%2FAirline_Review-d8729060-Reviews-Delta-Air-Lines*e.1578084630453; TADCID=06DvhsyMMDix3fewABQC5UI2n8iqRdCoS-RMXjJFU1puNBUhup5DBaEFTSyEOmrrImi4YgEyFEhz3VJq5iqibLwBfqDtx11goRs; PMC=V2*MS.39*MD.20191221*LD.20191229; __vt=gQKF1FBMsXg_E5FEABQCKh0bQ-d8T96qptG7UVr_ZQpNxE0BMeRWBFct9Un6hXRTO2x2cF4Z8caUlTfaBQGIpsGmWToLnuoP2DdpqZjOUe73KTkG8pH4XbA_5PgMBMGp3uRpkU9_6dIb-MXnomZal6JcJQ; PAC=ADWZS76ADrdgMk4ixYJDP8urU14BUugTZfDo60e7olwTierQCzqCjBqH0cQW_JfEoyPgvHaZLAs9YNdHVkwoKIZZPVFmG14c9y9-1EyH6xN3oVMsGQWW9tLZbE4O1qXzzONVIPDASFz_Z-oNpGXRT9P1STbtfHUuo6Xy-3ne8wup8ELH9bexG775B6LyDpftk9SpJdM55zpgJFwn6NHTdtOsCp7l7glFZi2caiugEPywTfWK61q_bKc-CS5n95wgwg%3D%3D; TAReturnTo=%1%%2FAirline_Review-d8729060-Reviews-Delta-Air-Lines; roybatty=TNI1625!AE2Dz6%2BuAcdVhlrZFfqf7XKBY3pwXEdB5C7tSHI1S3JNA8nrf6ng1yT5pOAC%2FWz3c03eM2p%2B77wtc66Ns49IKox%2FrnT%2FAZgJBR3wWN2o4s7juq5l7mfzSS1gQz5hZKN2o7ELan%2BH%2FPquVYEJhVnIeNqF4p85DbwaKP4cD%2FaoFRrr%2C1; SRT=%1%enc%3AmTM%2FgE33hsWDhcf3Gdi8%2FqLCiVzHYd99F36NmK9%2F7PkLHaQ5rjl2lFhioSN%2BbzmfjcUVV%2FjQ5bY%3D; TASession=V2ID.2845C2D3AB227D209B705F6094DD0F11*SQ.60*LS.DemandLoadAjax*GR.49*TCPAR.99*TBR.83*EXEX.75*ABTR.77*PHTB.43*FS.60*CPU.63*HS.recommended*ES.popularity*DS.5*SAS.popularity*FPS.oldFirst*FA.1*DF.0*TRA.true*LD.8729060; TAUD=LA-1576960936106-1*RDD-1-2019_12_21*HC-102503825*HDD-450122831-2020_01_05.2020_01_06*ARDD-450126042-2020_02_13.2020_02_14*HD-450132067-2020_02_13.2020_02_15.150813*G-450132068-2.2.150813.*LG-669928996-2.2.T.*LD-669928997-.....'},
                                body=json.loads(new_payload),
                                callback=self.parse,
            )


